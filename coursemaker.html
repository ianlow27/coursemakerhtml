<!DOCTYPE html><html><head><script>
let bdbgmode=false;
let coursefile='./coursedata.js';
let coursename='';
let coursedesc='';
let coursefldr='';
let sectionfldr='';
let sectionlist="";
let lngcontinue='Continue';
let lngcurrency='dollars';
let lngsteps='Steps';
let lngstepsleft='Steps left';
let lngtotscore='Total score';
let lngcrncysym='$';
let lngrestart='Restart';
let maxsteps=5;
let gmtotqstn=0;
let gmtotrght=0;
let gmtotwrng=0;
let lngtotqstn='Total questions';
let lngtotrght='Right';
let lngtotwrng='Wrong';
let currsteps=0;
let currmoney=0;
let currscore=0;
let b_en_btn = false;
let lesson01='';let lesson02='';let lesson03='';let lesson04='';let lesson05='';let lesson06='';let lesson07='';let lesson08='';let lesson09='';
let lesson10='';let lesson11='';let lesson12='';let lesson13='';let lesson14='';let lesson15='';let lesson16='';let lesson17='';let lesson18='';let lesson19='';
let lesson20='';let lesson21='';let lesson22='';let lesson23='';let lesson24='';let lesson25='';let lesson26='';let lesson27='';let lesson28='';let lesson29='';
let lesson30='';let lesson31='';let lesson32='';let lesson33='';let lesson34='';let lesson35='';let lesson36='';let lesson37='';let lesson38='';let lesson39='';let lesson40='';let lesson41='';let lesson42='';let lesson43='';let lesson44='';let lesson45='';let lesson46='';let lesson47='';let lesson48='';let lesson49='';let lesson50='';
let startqst=1; //0;//2; //2;// 0;
let asections=new Array(); 
let asectparts=new Array(); 
let anum2sect=new Array(); 
</script>
<!-- script src='./coursedatax.js'></script -->
<!-- script src='./coursedata1.jsx'></script -->
<script>
//---------üî¥--------------üü¢----------------
//--------------------------------------
function sections1(){
 // alert(42);
try{
  //alert(sectionlist);
const atmpsects=sectionlist.split(/%%%/);
anum2sect[0]="";
totsects=0;
for(i in atmpsects){
  const atmp1=atmpsects[i].split(/\|/);
  asections[atmp1[1]]=atmp1[0];
  asectparts[atmp1[1]]=Number(atmp1[2]);
  anum2sect[Number(i)+1]=atmp1[1];
//alert(anum2sect[Number(i)+1]+'__'+(i+1));
  totsects++;
  //alert(asections[atmp1[1]]+'='+atmp1[0]);
}//endfor
//alert(22);
  //alert(totsects);
}catch(e){
  dbgx(e.message);
}
}
//=======================================
let currpartid=0;
let prevpartid=0;
const appref='coursemakerhtml_'+coursefldr+'_'; //+sectionfldr+'_';
let part01='';let part02='';let part03='';let part04='';let part05='';let part06='';let part07='';let part08='';let part09='';
let part10='';let part11='';let part12='';let part13='';let part14='';let part15='';let part16='';let part17='';let part18='';let part19='';
let part20='';let part21='';let part22='';let part23='';let part24='';let part25='';let part26='';let part27='';let part28='';let part29='';
let part30='';let part31='';let part32='';let part33='';let part34='';let part35='';let part36='';let part37='';let part38='';let part39=''; let part40='';let part41='';let part42='';let part43='';let part44='';let part45='';let part46='';let part47='';let part48='';let part49='';let part50='';

//----------------------------------
</script>
<style>
pre  {font-family: Times New Roman;white-space:pre-wrap;xfont-size:70%;word-wrap:break-word;margin:0px;padding:0px;width:98%;} /*!!*/
textarea {font-size:100%;font-family: Arial;Times New Roman;}
button {font-size:80%;}
::xbackdrop { background-image: linear-gradient( 45deg, grey, aliceblue, lightblue, azure); opacity: 0.40;}
::backdrop { background-image: linear-gradient( 0deg, darkgrey, darkgrey, darkgrey, darkgrey); opacity: 0.75;}
</style> 
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
</head>
<body id='bd1' style='padding:6px;font-size:80%;font-family:Times New Roman;xcolor:white;background-color:#efefea;'>
<div id='dvscript'></div>
<div id='dvscore'></div>
<div id='dvstat'></div>
<center>
<dialog id='dlg1' style='background-color:#685858 margin-top:0px;width:98%;'>
  <button autofocus onclick='dlg1cls();'>Close</button>
  <pre id='prdlg1'></pre>
</dialog>
</center>

<center>
<span style='font-size:70%;'><b>github.com/ianlow27/CourseMakerHTML</b> 0.0.11_250112-1911</span><br/>
<textarea id='tx1' style='display:none;width:95%;height:100px;'></textarea>

<i><span id='h6part' style='text-decoration:italic;font-weight:bold;font-size:108%;'></span></i>
<br/><span id='h3part' style='font-weight:bold;font-size:128%;'></span> <!-- !! -->
<br/><span id='h1part' style='font-weight:normal;font-size:110%;'></span> <!-- !! -->
</center>
<br/><button id='btn1' style='display:none;' onclick='gencourse();'>Begin</button>
<div id='dv1' style='font-weight:normal;'>Loading...</div>
<script>
//=========================================
//=========================================
//=========================================
//=========================================
//=========================================
//=========================================
//=========================================
//alert(11111);
let currsect=1;
let maxsect=1;
let currsectname='';
let currpart=1;
let currpartname='';
let currqst=0;
let totparts=0;
let totsects=0;
let bshow_en=true;
//alert(sprintf0d(2, currpart));
//if(localStorage.getItem(appref+'tx1')==null){
//  localStorage.setItem(appref+'tx1', eval('part'+sprintf0d(2,currpart)) );
//}
//---------------------------
//!!
function seturlparms(){
try{
  const srchprms = new URLSearchParams(document.location.search);
  const gotoref=srchprms.get('goto');
  if(gotoref){
    //alert(gotoref);
    const atmp1=gotoref.split(/\-/);
    if(typeof atmp1[2] != 'undefined'){
      //sections1();
      currsect=Number(atmp1[0]);     
      currpart=Number(atmp1[1]);
      currqst=Number(atmp1[2]);
      maxsect=currsect;
      sectionfldr=anum2sect[currsect];
      //dbgx(sectionfldr);
      savecurrpos();
    }
  }
}catch(e){
  alert(e.message);
}
}

//alert(eval('part'+'01'));
tx1=document.getElementById('tx1');tx1.value='';
dv1=document.getElementById('dv1');
h1part=document.getElementById('h1part'); //!!
h6part=document.getElementById('h6part'); //!!
h3part=document.getElementById('h3part'); //!!
btn1=document.getElementById('btn1');
dvstat=document.getElementById('dvstat');
bd1=document.getElementById('bd1');
dvscript=document.getElementById('dvscript');
dvscore=document.getElementById('dvscore');
//localStorage.getItem(appref+'tx1');
let alines1 = Array(); //tx1.value.split(/\n/);
let alines = Array();
//=============================
function loadjsxx(jsfile, onloadfunc){
  //prevpartid=currpartid;
  //currpartid++;
dbg(jsfile);
    const scriptobj = document.createElement('script');
    scriptobj.src = jsfile;
    scriptobj.id='currlib';
    scriptobj.onload = onloadfunc;
    scriptobj.onreadystatechange = onloadfunc;
    document.body.appendChild(scriptobj);
}//;//endfunc

function loadjs(psectionfldr, pcurrpart){
//dbg(jsfile);
  const jsfile='./'+coursefldr+'/'+psectionfldr+'/part'+sprintf0d(2,pcurrpart)+'.js';
  //const jsid='scr_'+psectionfldr+'_'+pcurrpart;
  loadjsfile(jsfile); //, jsid);
}//endfunc

function loadjsfile(jsfile){
    const scriptobj=document.createElement('script');
 //alert(jsfile);
    scriptobj.src = jsfile;
    scriptobj.id='src_'+(jsfile.replace(/\./g,'').replace(/\//g,'_'));
    scriptobj.onload = loadedjs;
    scriptobj.onreadystatechange = loadedjs;
    dvscript.appendChild(scriptobj);
}//;//endfunc
//---------------
function unloadjs(psectionfldr, pcurrpart){
dbg(101);
try{
  dvscript.innerHTML="";
  /*
const parent = document.getElementById("dvscript");
const child = document.getElementById('scr_'+psectionfldr+'_'+pcurrpart);
const throwawayNode = parent.removeChild(child);
*/


  //if(child.parentNode){
   // child.parentNode.removeChild(child);
  //}
  /*
  let prevpart=document.getElementById('scr_'+psectionfldr+'_'+pcurrpart);
  //const parent1=prevpart.parentNode;
  //parent1.removeChild(prevpart);
  delete prevpart;
  */
}catch(e){
  dbg('>>e1:'+e.message);
}
}//endfunc
//-----------------------------------
let loadedjs=function(){
try{
  //sections1();
dbg(totparts,currpart);
  totparts=currpart; 
  if(eval('part'+sprintf0d(2,currpart+1))!=''){
    totparts= currpart+1;
  }
  //alert(loadedtest1());
 // if(!currqst) currqst=startqst;
//alert(1+'____'+currpart);
//try{
  
  if(!currqst){
//alert(2);
    showlandingpg();
  }else {
//alert('121>>Loaded!!!');
    gencourse();//<===!!!!!!!!!!!!!
  }
  
}catch(e){
  dbg('>>e2:'+e.message);
}
};//endfunc
//=============================
loadjsfile(coursefile); 
if(!bdbgmode){
/*dv1.style.display='none';
h1part=document.getElementById('h1part'); //!!
h6part=document.getElementById('h6part'); //!!
h3part=document.getElementById('h3part'); //!!
btn1
*/
dvstat.style.display='none';
//bd1.style.display='none';
//dvscript
dvscore.style.display='none';
}
setTimeout('loadsection()',500);
//--------------------------------------
function loadfiles(){
try{
  //initdata();
  sections1(); 
  
//alert(sectionfldr+'_en');
 // loadjs(sectionfldr+'', currpart);

//alert(asectparts[sectionfldr]);
  for(let i=1; i<=asectparts[sectionfldr]; i++){
    loadjs(sectionfldr+'', i);
  }
  setTimeout('loadedjs2()',0);
}catch(e){
  dbg(e.message);
}
}//endfunc
//--------------------------------------
function loadedjs2(){
  if(!currqst){
    showlandingpg();
  }else {
    gencourse();//<===!!!!!!!!!!!!!
  }
}//endfunc
//=============================
//=============================
function gencourse(){
//tx1.value='jhfgg'; //eval('part'+sprintf0d(2, currpart)); 
try{
 dbg(144);
  if(!initgencourse()) return; 
  tx1.style.display='none';
  btn1.style.display='none';
  dbg(146);
  let strout='';
 
  for(i in alines){
    let qststr="";
    let ansstr='';
    let ansidstr='';
    let functype='';
    const i1 = Number(i)+1;
    if(currqst > alines.length){
      //alert('End of part');
      functype='endcourse';
      strout='<h2>End of Part</h2>';
      strout+=  "<br/><button id='btnbk' onclick='goback();'>Back</button>&emsp;&emsp;";
      if(currpart < totparts){
      }
      break;
    }
    if(i1 > currqst) break;
    if(i1 < currqst) continue;
    alines[i] = alines[i].replace(/^[\s\*\-\_\=]+/g, "");
    const aqst=alines[i].split(/\|/);
//alert(aqst.length);
    let asel=Array();
    if(typeof aqst[1] != 'undefined') 
      asel=aqst[1].split(/\[/);
    const aqst1=aqst[0].split(/%%%/);
    aqst[0]=aqst1[0];
    if(aqst.length < 2){
      //alert(776);
      functype="info";
      //qststr=aqst[0];
      //alert(1);
    }else if(aqst.length == 2){
      functype="fillblanks";
      for(j in asel){
        //alert(asel[j]);
        if(asel[j].match(/\]/)){
          const atmp1=asel[j].split(/\]/);
          if(ansstr!="") ansstr+="|";
          ansstr+=atmp1[0];
          if(ansidstr!="") ansidstr+="|";
          ansidstr+='ans'+i1+'_'+j;
          qststr+="<input id='"+'ans'+i1+'_'+j+ "' style='width:50px' name='"+aqst[j]+"'></input>"+atmp1[1];
        }else {
          qststr+=asel[j];
        }
       // qststr+="</input>"+asel[j];
      }//endfor
      //alert(qststr);
      //alert(ansstr);
      //alert(ansidstr);
    //---------------------------------
    }else if(  (aqst.length == 4) && (aqst[1].match(/[0-9]+/) )  ){
      functype="vocabwrite";
      //alert('write article');
      qststr+="<input id='minchrs' type='hidden' value='"+aqst[1]+"' />";      
      qststr+="<input id='exclwrds' type='hidden' value='"+aqst[2]+"' />";
      qststr+="<input id='inclwrds' type='hidden' value='"+aqst[3]+"' />";      
      qststr+="<div style='font-size:80%;color:red;'><b>Disallowed words:</b> "+aqst[2]+"</div>"
      +"<div style='font-size:80%;color:green;'><b>Required words:</b> "+aqst[3]+"</div>"
      +"<div style='font-size:80%;color:darkslategray;'><b>Minimum chars:</b> "+aqst[1]+"</div>"
+"<textarea id='txtvcbwrite"+currref()+"' style='width:95%;height:100px;' >loading...</textarea>";
      setTimeout('poptxtvcbwrite(currref());', 800);
    //---------------------------------     
    }else {
      let itype='radio';
      let countsel=0
      for(let j=1; j<aqst.length; j++){
        if(aqst[j].match(/\]/)){
          countsel++;
        }
      }//endfor
      if(countsel>1) itype='checkbox';
      for(let j=1; j<aqst.length; j++){
        functype="multiselect";
        if(ansstr!="") ansstr+="|";
        if(aqst[j].match(/\]/)){
          ansstr+="true";
        }else{
          ansstr+="false";
        }
        let qstidx=0;
        if(itype=='checkbox') qstidx=j;
        const atmp1=aqst[j].split(/%%%/);
        if(ansidstr!="") ansidstr+="|";
        ansidstr+='ans'+i1+'_'+j;
        qststr+="<input type='"+itype+"' id='"+'ans'+i1+'_'+j+ "' name='"+aqst[qstidx]+"' style='width:50px'/>"+
           atmp1[0].replace(/[\[\]]/g,'')+
           "</label><br/>";
      }//endfor
    }//endif

    let btnstr='Submit';
    if(functype=='info') btnstr=lngcontinue;
    if(functype=='endcourse') btnstr='Finish';
    bckstr='';
    //if(i1>1)
    bckstr =
       "<button id='btnbk' onclick='goback();'>Back</button>&emsp;&emsp;";

    strout+= //!!
      "<div id='qst"+i1+"' style='display:none;'>"+
      //i1 +"/"+alines.length + " "+
     
      //----------------------!!
      aqst[0]
         .replace(/##(\d+)/g, currpart+'.'+currqst+'.'+"$1 ")
         .replace(/##(\s+)/g, currpart+'.'+currqst+''+"$1")
         .replace(/''([\w\-\s\.\-_]+)''/g, "<i>$1</i>")
         .replace(/\{\{/g, '<b>')
         .replace(/\}\}/g, '</b>')
         .replace(/\[\[/g, '<i>')
         .replace(/\]\]/g, '</i>')
         .replace(/>>>/g, '<br/><br/>')
         .replace(/>>/g, '<br/>')
         .replace(/\{([a-z0-9\-_]+)\.mp4\}/g, "<video controls width='96%' controlslist='nofullscreen nodownload noremoteplayback noplaybackrate foobar' ><source src='./"+coursefldr+"/"+sectionfldr+"/$1.mp4' type='video/mp4' ></video>")
     .replace(/\{([a-z0-9\-_]+)\.(png|gif|jpg)\}/g, "<center><img style='max-width:96%;max-height:150px;xtext-alignment:center;' src='./"+coursefldr+"/"+sectionfldr+"/$1.$2'  ></img></center>")
     .replace(/\{([a-z0-9\-_]+)\.(mp3|m4a)\}/g, 
"<audio controls controlslist='nofullscreen nodownload noremoteplayback noplaybackrate foobar' ><source src='./"+coursefldr+"/"+sectionfldr+"/$1.$2' type='audio/mpeg' ></audio>")
         + "<br/>"+
      qststr+ "<br/>"+
      //----------------------!!
      '<center>'+
      bckstr +
      "<button id='qbtn"+i1+"' onclick='procans(\"" + functype 
        + "\",\""+ansstr
        +"\",\""+ansidstr
        +"\",\""
        +( (typeof aqst1[1]!='undefined')
          ? aqst1[1] : '' ) 
        +"\",\""
        +( (typeof aqst1[2]!='undefined')
          ? aqst1[2] : '' ) 
          +"\");'>"+btnstr+"</button>" +
         '</center>'+
      "</div>"; 

  }//endfor
  //alert(appref);
  if(b_en_btn){
    strout="<button id='bt_en' style='visibility:"+(!bshow_en ? 'hidden' : 'visible' )+"' onclick='showtrans();'>EN</button>"
  +strout;
  }
  //alert(dv1);
  dv1.innerHTML=strout;
   dbg('qst'+currqst);
  document.getElementById('qst'+currqst).style.display='block';
  
}catch(e){
  dbg('>>e3:'+e.message);
}

}//endfunc
//--------------------------------------
function procans(ptype, pans, 
pansid, pcrrctmsg='', pincrrmsg=''){
  let redirstr='';
  let bnextq = true;
  
try{
//dbgx(ptype);
if(ptype=='info'){
  //alert(256);
   incrlevel(); //currqst++;
}else {
  //alert(pans);
  //alert(pansid);
  //---------------------------
  if(ptype=='vocabwrite'){
    const exclwrds = document.querySelector('#exclwrds');
    const inclwrds = document.querySelector('#inclwrds');
    const minchrs = document.querySelector('#minchrs');
    const txtvcbwrite = document.querySelector('#txtvcbwrite'+currref());
//dbgx(txtvcbwrite.value);
    localStorage.setItem(appref+'txtvcbwrite'+currref(), txtvcbwrite.value);
    let aexcl=Array();
    let aincl=Array();
    let bok=true;
    if (exclwrds) {
	  aexcl =exclwrds.value.split(/\s/);
	  for(let i in aexcl){
		let rgx1='';
		if(aexcl[i].substr(0,1)=='['){
	      rgx1=new RegExp(aexcl[i], 'ig');
	    }else{
	      rgx1=new RegExp('\\b'+aexcl[i]+'\\b', 'ig');
		}
		//alert(aexcl[i]);
		if(String(txtvcbwrite.value).match(rgx1)){
			alert(aexcl[i]+' found!!');
			bok=false;
			break;
	    }
      }
    }
    if( (inclwrds) && (bok)){
      aincl =inclwrds.value.split(/\s/);
	  for(let i in aincl){
        let rgx1=new RegExp('\\b'+aincl[i]+'\\b', 'ig');
		//alert(aexcl[i]);
		if(!String(txtvcbwrite.value).match(rgx1)){
			alert(aincl[i]+' missing!!');
			bok=false;
			break;
	    }
      }
    }
    if( (minchrs) && (bok)){
	  if(txtvcbwrite.value.length < minchrs.value){
		alert('insufficient chars: '+txtvcbwrite.value.length);
	    bok=false;
      }
    }
    if(!bok){
      bnextq=false;
    }
    
  //---------------------------
  }else{
    const aansid=pansid.split(/\|/);
    const aans=pans.split(/\|/);
    //let bnextq = true;
    gmtotqstn++;
    
    for(i in aansid){
      const obj = document.getElementById(aansid[i]);
      if(ptype=="fillblanks"){
        if(obj.value  != aans[i]){
          bnextq = false;
        }
      }else if(ptype=="multiselect"){
        if(String(obj.checked) != String(aans[i])){
           bnextq = false; 
        }
      }
    }//endfor
  }//endif
  //---------------------------

  let strmsg='';

  if(bnextq){
    strmsg+="Well done! Your answer was correct!  <br/><span style='font-size:150%'> üòÑ üëç </span>\n";
    if(pcrrctmsg.trim()){
      const atmp2=pcrrctmsg.split(/#/);
      strmsg+=atmp2[0]+'\n';
      for(let i in atmp2){
        if(atmp2[i].match(/\+/)){
          if(atmp2[i].substr(0,10)
             =='currmoney+'){
             currmoney+=Number(
               atmp2[i].substr(10));
          }else if(atmp2[i].substr(0,10)
             =='currscore+'){
             currscore+=Number(
               atmp2[i].substr(10));
          }
        }
      }//endfor
    }
    gmtotrght++; dbg('CORRECTANS');
    incrlevel(); //currqst++; //!!
  }else {
    strmsg+='Your answer was incorrect\n';
    if(pincrrmsg.trim()){
      const atmp2=pincrrmsg.split(/#/);
      strmsg+=atmp2[0];
      for(let i in atmp2){
        //alert(atmp2[i]);
        if(atmp2[i].match(/\-/)){
          if(atmp2[i].substr(0,10)
             =='currmoney-'){
             currmoney-=Number(
               atmp2[i].substr(10));
          }else if(atmp2[i].substr(0,10)
             =='currscore-'){
             currscore-=Number(
               atmp2[i].substr(10));
          }
        }else if(atmp2[i].substr(0,6)=='redir='){
          redirstr=atmp2[i].substr(6);
        }
      }//endfor
    }//endif 
    gmtotwrng++; dbg('INCORRECTANS');
  }//endif bnextq
  msgout(strmsg);
}//endif
}catch(e){
  dbg('>>e4:'+e.message);
}
  if(redirstr){
    const aredir=redirstr.split(/\^/);
    startsection(aredir[0],
       Number(aredir[1]),
       Number(aredir[2]));
  }
  setTimeout('gencourse()', 0);
}//endfunc
//--------------------------------------
function goback(){ //!!
let outcome='gencourse';
  currqst--;
  if(!currqst){
    currqst=1;
    currpart--;
    if(!currpart){
      currpart=1;
      outcome='showlandingpg';
    }
  }
  savecurrpos();
  eval(outcome+'();');
}//endfunc
//---------------------
function incrlevel(ptype='qst'){ //!!
let outcome='';
  if(ptype=='qst'){
    currqst++;
    if(currqst>(alines.length)){
      //alert('end of part') ;
      currpart++;
      currqst=1;
      if(currpart > asectparts[sectionfldr]){ //otparts){
  //alert('end of section');
        if((currsect==maxsect) 
          &&(maxsect<=totsects)){
          currsect++;
          maxsect++;
          if(maxsect > totsects){
            msgout('Congratulations on completing this course!');
          }
        }
     //alert('end of section 2');
dbgx('SHOWLANDINGPG');
        //showlandingpg();
        outcome='showlandingpg';
        //alert('end of course');
      }else{
dbgx('GENCOURSE');
//loadsection();
        outcome='gencourse';
      }
    }
  }else{
  }
  
savecurrpos();
if(outcome) eval(outcome+'();');
}//endfunc
//---------------------
function sprintf0d(pwidth=2, pval=0){ //!!
  if(pwidth>10) pwidth=10;
  if(isNaN(pval)) pval=0;
  if(pval<0) pval=0;
  pbase='1';
  for(let i=0; i<(pwidth-1); i++){
    pbase+='0';
  }
  const retval = (String(pbase).length - String(pval).length) + 1;
  return retval > 0 ? 
       new Array(retval).join('0') + pval :
       pval;
}
//--------------------------------------
function initgencourse(){ //!!



//dbgx(asections[sectionfldr]+'__'+(sectionfldr));



updscores(currsteps+1);
dbg('386>>part'+sprintf0d(2, currpart));
tx1.value=eval('part'+sprintf0d(2, currpart));
//currqst=1;
alines1 = tx1.value.split(/\n/);
alines = Array();
dbg('391>>'+tx1.value);
for(i in alines1){
//dbg(alines1[i]);
  alines1[i]=alines1[i].trim();
  if(alines1[i]==""){
  }else if((alines1[i].substr(0,1)=="{")
     && (alines1[i].substr(alines1[i].length-1,1)=='}')){
    //coursename =alines1[i].substr(1,alines1[i].length-2);
  }else if((alines1[i].substr(0,2)=="/*") && (alines1[i].substr(alines1[i].length-2,2)=='*/')){
       //dbg('___111'+alines1[i].substr(alines1[i].length-2,2));
    //do nothing ignore comment
  }else if((alines1[i].substr(0,1)=="[")
     && (alines1[i].substr(alines1[i].length-1,1)==']')){
    currpartname =alines1[i].substr(1,alines1[i].length-2);
  }else{
    alines.push(alines1[i]);
  }
}//endfor

h6part.innerHTML=coursename;

if(typeof asections[sectionfldr] != 'undefined')
h3part.innerHTML='Section ' + asections[sectionfldr];

h1part.innerHTML='Part '+currpart 
+(currpartname!=''? ': '+currpartname : '')+prg1()
+ '<br/><b><u>Lesson '+currqst+' (of '+alines.length +')</u></b>'
;

try{

totparts=0;
for(i=1; i<=10; i++){
  if(typeof eval('part'+sprintf0d(2,i)) =='undefined'){ 
  //dbg('----1',i);
  break;
  }else if(String(eval('part'+sprintf0d(2,i))).trim()==''){ 
    //dbg('part'+sprintf0d(2,i));
	  //dbg('----2',i);
break;
  }else {
    //alert('['+eval('part'+sprintf0d(2,i)).trim()+']')
    totparts=i;
  }
}//endfor
//if(!totparts) totparts=1;
//dbg(currpart, totparts);
if(currpart > totparts){
  //h1part.innerHTML = 'Congratulations! You have completed the section!';
  return 0;
}
//dbg('totparts='+totparts);
//====================================
//====================================
//====================================
if(!currqst){
  currqst=1;
  let strout='jjggg jhgffx jh';
  dv1.innerHTML=strout;
  return 0;
}
//====================================
//====================================
//====================================
}catch(e){
  dbg('>>e5:'+e.message);
}
return 1;
}//endfunc
//--------------------------------------
function showlandingpg(){
try{
 loadcurrpos();
 sections1();
setTimeout("h6part.innerHTML='"+coursename+"'; h1part.innerHTML='"+coursedesc+"'+prg1('showlandingpg'); h3part.innerHTML='';", 800);
  let strout='';
  const asects=sectionlist.split(/%%%/);
  //alert("'./"+coursefldr+"/cover.png'");
  strout+="<center><img src='./"+coursefldr+"/cover.png' ></img>";
  strout+='<table>';
  for(i in asects){
    const atmp1=asects[i].split(/\|/);
    if(strout!='') strout+='';
    strout+="<tr><td valign='top' width='99%'><b>"+atmp1[0]+':</b> '+atmp1[3]+ "</td><td valign='top'><button style='text-align:right;";
    // strout+='<b style="font-size:110%;">'+atmp1[0]+': </b>' + atmp1[3] +  "<div style='text-align:right;'><button style='text-align:right;";
    if(i < maxsect){
//alert('1__'+maxsect);
      //alert(1);
     strout+="'  onclick='startsection( \""+atmp1[1]+"\");'>";// , \""+atmp1[0]+"\");'>";
    }else {
//alert('2__'+maxsect);
      //alert(2);
      strout+="  color:#bbb;'>";
    }
    strout+='Start</button></td></tr>'; //</div>';
  }//endfor
  strout+='</table></center>';
//alert('1__'+maxsect+'__'+totsects);
  if((maxsect >= totsects)&&(totsects)){
    strout+="<button onclick='restart();'>"+lngrestart+"</button>";
  }

  //alert(strout);
  dv1.innerHTML=strout;
    //alert('end of section 4');
  return 0;
}catch(e){
  dbg('>>e6:'+e.message);
}
}//endfunc
//--------------------------------------
function startsection(psection,pcurrpart=1,pcurrqst=1){
//dbgx(psection);
try{
  unloadjs(sectionfldr, currpart);
  //alert(2);
  part01='';
  currqst=pcurrqst;
  currpart=pcurrpart;
  startqst=pcurrqst;
  sectionfldr=psection;
  currsect=Number(sectionfldr.substr(0,1));
  //currsectname=pname;
dbg(468);
   //initdata();
   //loadjs(sectionfldr+'_en', currpart);
  // if(!part01)   
//   loadjs(sectionfldr, currpart);
  loadfiles();
     
   //alert(33);
}catch(e){
  dbg('>>e7:'+e.message);
}
}//endfunc
//--------------------------------------
function dbgx(pstr,pstr1='',pstr2='',) {
  const e = new Error();
  const regex = /^(.*)\((.*):(\d+):(\d+)\)$/
  const match = regex.exec(e.stack.split("\n")[2]);
  dbg(pstr,pstr1,pstr2,'x', '['+match[1].trim()+': l.'+match[3]+']\n');
}//endfunc
//--------------------------------------
function dbg(pstr,pstr1='',pstr2='',px='',linenum='') {
if(!linenum){
  const e = new Error();
  const regex = /^(.*)\((.*):(\d+):(\d+)\)$/
  const match = regex.exec(e.stack.split("\n")[2]);
  linenum=  '['+match[1].trim()+': l.'+match[3]+']\n';
}
  
  const msg =
   linenum
   +'coursefldr='+coursefldr+' ;'
   +'totsects='  +totsects +'; '
   +'totparts='  +totparts +'; \n'
   +'sectionfldr='  +sectionfldr +'; '
   +'asctpts[stnf]='+asectparts[sectionfldr]+'; '
   +'maxsect='  +maxsect +'; '
   +'currsect='  +currsect +'; '
   +'currpart='  +currpart +'; '
   +'currqst='   +currqst  +'; \n'
   +'gmtotqstn=' +gmtotqstn+'; '
   +'gmtotrght=' +gmtotrght+'; '
   +'gmtotwrng=' +gmtotwrng+'; '
   +pstr+'___'+pstr1 ; 
  if(px){
    alert(msg);
  }else{
    dvstat.innerHTML = msg;
  }
  // ); 
}
//------------------
function updscores(pcurrsteps=null){
  //dbgx(pcurrsteps);üíµ
  if(pcurrsteps) currsteps=pcurrsteps;
  else currsteps++;
  let strout="<span style='background-color:#ffffca;'>"
  
     +lngtotqstn+'üíØ: '+gmtotqstn+ '|'
     +lngtotrght+'‚úÖ: '+gmtotrght+ '|'
     +lngtotwrng+'‚ùå: '+gmtotwrng+ '|'
  
     +lngsteps+'üë£: '+currsteps + '|'
     +lngstepsleft+'üéØ: '+(Number(maxsteps) +Number(0-currsteps)) + '|'
     +lngcurrency+'ü™ô: '+lngcrncysym+currmoney + '|'
     +lngtotscore+'üíØ: '+currscore + '|</span>'
     ;
  dvscore.innerHTML=strout;

}//endfunc
//------------------
function msgout(pmsg){ 
  dlg1 = document.getElementById('dlg1');
  prdlg1.innerHTML = pmsg;
  dlg1.showModal();
 
}//endfunc
//------------------
function dlg1cls(){ 
  dlg1 = document.getElementById('dlg1');
  dlg1.close();
}//endfunc
//------------------
function showtrans(){
  bshow_en=false;
  loadjs(sectionfldr+'_en', currpart);
  setTimeout("bshow_en=true; loadjs(sectionfldr, currpart)",5000);
}
//------------------
function restart(){
if(prompt('Please enter y if you want to restart from the very beginning:') == 'y'){
  maxsect=1;
  currsect=1;
  currpart=1;
  currqst=1;
  savecurrpos();
  showlandingpg();
}
}//endfunc
//------------------
function initdata(){
lesson01='';lesson02='';lesson03='';lesson04='';lesson05='';lesson06='';lesson07='';lesson08='';lesson09='';
lesson10='';lesson11='';lesson12='';lesson13='';lesson14='';lesson15='';lesson16='';lesson17='';lesson18='';lesson19='';
lesson20='';lesson21='';lesson22='';lesson23='';lesson24='';lesson25='';lesson26='';lesson27='';lesson28='';lesson29='';
lesson30='';lesson31='';lesson32='';lesson33='';lesson34='';lesson35='';lesson36='';lesson37='';lesson38='';lesson39='';lesson40='';lesson41='';lesson42='';lesson43='';lesson44='';lesson45='';lesson46='';lesson47='';lesson48='';lesson49='';lesson50='';

part01='';part02='';part03='';part04='';part05='';part06='';part07='';part08='';part09='';
part10='';part11='';part12='';part13='';part14='';part15='';part16='';part17='';part18='';part19='';
part20='';part21='';part22='';part23='';part24='';part25='';part26='';part27='';part28='';part29='';
part30='';part31='';part32='';part33='';part34='';part35='';part36='';part37='';part38='';part39=''; part40='';part41='';part42='';part43='';part44='';part45='';part46='';part47='';part48='';part49='';part50='';

}//endfunc
//------------------
function loadsection(){
sections1();
seturlparms();
//dbgx(820+'__'+anum2sect[5]+'__'+currsect);
loadcurrpos();
if((currqst==1)&&(currpart==1))
  showlandingpg();
else
  loadfiles();
}//endfunc
//------------------
function savecurrpos(){
  localStorage.setItem(appref+'currpos',
    currsect+'-'+
    currpart+'-'+
    currqst+'-'+
    maxsect+'-'+
    sectionfldr);
}
//------------------
function loadcurrpos(){
  //dbgx(localStorage.getItem(appref+'currpos'));
  const atmp1=String(
    localStorage.getItem(appref+'currpos') )
    .split(/\-/);
if(typeof atmp1[4]!='undefined'){
  currsect=Number(atmp1[0]);
  currpart=Number(atmp1[1]);
  currqst=Number(atmp1[2]);
  maxsect=Number(atmp1[3]);
  sectionfldr=atmp1[4];
}
}//endfunc
//------------------
function poptxtvcbwrite(pcurrref=''){
  //dbgx(pcurrref);
  const txtvcbwrite = document.querySelector('#txtvcbwrite'+pcurrref);
  if(txtvcbwrite){
    const valstr=localStorage.getItem(appref+'txtvcbwrite'+pcurrref);
    txtvcbwrite.value = (valstr ? valstr : '');
  }
}//endfunc
//------------------
function currref(){
  const retval =currsect+'-'+currpart+'-'+currqst;
  //dbgx(retval);

return retval;
}//endfunc
//------------------
function prg1(popt=''){
let prg1="<div style='white-space:pre-wrap;xfont-size:70%;word-wrap:break-word;'>";
//alert(currsect+'______'+totsects+'\n'+currpart+'______'+totparts );
//----------------------------
for(let i=0; i<maxsect; i++){
  if(i > totsects-1) break;
  if( (i==(currsect - 1)) && (!popt)){
    prg1+="<span style='font-size:150%'>üü™</span>";
  }else{
    prg1+='üü™'; //üèÖ';
  }
}
for(let i=0; i<(totsects - maxsect); i++){
  prg1+='üü®'; //üü°';
}
prg1+='<br/>';
//----------------------------
for(let i=0; i<currpart; i++){
  prg1+='üü¶'; //üîµ';
}
for(let i=0; i<(totparts - currpart); i++){

    prg1+='üüß';
}
prg1+='<br/>';
//----------------------------
for(let i=0; i<currqst; i++){
  prg1+='üü©';//üü¢';
}
for(let i=0; i<alines.length - currqst; i++){
  prg1+='‚¨ú'; //‚¨õ'; //üü•';//üî¥';
}
prg1+='</div>';
return prg1;
}//endfunc
//------------------
// + "Describe your holiday|200|i [jkqxz] thou he she it we they you|fi ti ef hi ni chi nhw\n"
//------------------
//alert(8888);
//--------------------------------------
//--------------------------------------
//--------------------------------------
//--------------------------------------
//--------------------------------------
</script></body></html>